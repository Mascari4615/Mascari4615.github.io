---
title: "🌒 C# Delegate (Action, Func, Event)"
date: 2024-04-24. 14:21
# last_modified_at: 2024-08-29. 20:57
last_modified_at: 2024-09-04. 10:08
categories: [⭐Computer, 🌒Programming]
tags: [CSharp, Delegate, Event, Action, Func]
---

## 💫 Delegate | 대리자

---

메서드의 참조.  

메서드를 변수처럼 쓸 수 있게 해준다 !  
Like 함수 포인터 in C/C++.  

메서드를 변수에 할당하고, 다른 메서드의 인자로 전달하거나 반환 값으로 사용할 수 있다.  

주로 이벤트 처리, 비동기 처리, 콜백 함수를 구현할 때 사용된다.  

### 🫧 Delegate 구현

`delegate 반환타입 MyDelegate(매개변수);` 형식으로 선언한다.  
매개변수는 필요한 만큼 선언할 수 있다. (0 ~ 16개)  

```cs
// 선언
delegate void MyDelegate(string msg);

// 정의
void Method1(string msg) => Console.WriteLine(msg);

// 인스턴스 생성
MyDelegate myDelegate = new MyDelegate(Method1);

// 호출
myDelegate("Hello, World!");

// Output :
// Hello, World!
```

### 🫧 Delegate 체인

`+`, `-` 연산자를 이용해 한 `delegate`에 여러 메서드를 할당할 수 있다.  
그렇게 할당한 여러 메서드를 한번에 호출할 수 있다. (멀티캐스트)  

```cs
// 선언
delegate void MyDelegate(string msg);

// 정의
void Method1(string msg) => Console.WriteLine(msg);
void Method2(string msg) => Console.WriteLine(msg);

// 인스턴스 생성
MyDelegate myDelegate = new MyDelegate();
myDelegate += Method1;
myDelegate += Method2;

// 호출
myDelegate("Hello, World!");

// Output :
// Hello, World!
// Hello, World!
```

### 🫧 Delegate 무명함수, 람다식 활용

무명함수와 람다식(익명함수)을 사용할 수 있다.  

```cs
// 선언
delegate void MyDelegate(string msg);

// 인스턴스 생성 (With 무명함수, 람다식)
MyDelegate myDelegate = delegate (string msg) { Console.WriteLine(msg); };
myDelegate += (string msg) => { Console.WriteLine(msg); };

// 호출
myDelegate("Hello, World!");

// Output :
// Hello, World!
// Hello, World!
```

### 🫧 [Delegate 비동기 처리 (Invoke/BeginInvoke)](https://learn.microsoft.com/ko-kr/dotnet/standard/asynchronous-programming-patterns/asynchronous-programming-using-delegates)

`Invoke`나 `BeginInvoke`, `EndInvoke`를 이용해 비동기 처리를 할 수 있다.  
쓸 수는 있지만 오래된 방식이므로, 비동기 처리는 [`Task`](/posts/Thread-Task/)를 쓰는 것이 더 바람직하다.  

```cs
// https://www.csharpstudy.com/Threads/async-delegate.aspx

// 선언 및 인스턴스 생성
Func<int, int, int> work = GetArea;

// 정의
int GetArea(int height, int width)
{
	int area = height * width;
	return area;
}

// 비동기 처리
IAsyncResult asyncRes = work.BeginInvoke(10, 20, null, null);
int result = work.EndInvoke(asyncRes);
```

## 💫 Delegate의 일반화

---

일일이 `delegate`를 정의하는 것이 번거롭다면,  
`Action`, `Func`, `Predicate` 등을 사용할 수 있다.

### 🫧 Action

`delegate`의 일반화로, 반환 값이 **없는**(`void`) 메서드를 참조할 수 있는 `delegate`.  
매개변수는 0 ~ 16개까지 선언할 수 있다.  

```cs
Action<string> myAction = (msg) => Console.WriteLine(msg);
myAction("Hello, World!"); // Hello, World!

Action<int, int> myAction = (a, b) => a + b;
myAction(1, 2); // 3
```

### 🫧 Func

`delegate`의 일반화로, 반환 값이 **있는**(`void` 제외) 메서드를 참조할 수 있는 `delegate`.  
매개변수는 0 ~ 16개까지 선언할 수 있고, 마지막 매개변수가 반환 값이 된다.  

```cs
Func<int, int, int> myFunc = (a, b) => a + b;
myFunc(1, 2); // 3
```

### 🫧 Predicate

`Func`의 특수한 형태로, 반환 값이 `bool`인 `delegate`.  
하나의 매개변수를 받아 `bool` 값을 반환한다.  

```cs
Predicate<int> myPredicate = (num) => num > 0;
myPredicate(1); // True
```

## 💫 Event | 이벤트

---

`이벤트(사건)`를 구현하기 위해 몇 가지 제약을 가진 `delegate`.  

이벤트는 객체의 상태 변화, 사건의 발생을 다른 객체나 메서드에 알리기 위해 사용된다.  
다른 객체나 메서드에서 이벤트를 구독하고, 이벤트가 발생하면 알림을 받아 처리할 수 있다.  

### 🫧 Event가 Delegate와 다른 점

1. `delegate`는 클래스 외부에서 직접 호출할 수 있지만, `event`는 클래스 내부에서만 호출할 수 있다.
2. `delegate`는 `null`을 가질 수 있지만, `event`는 `null`을 가질 수 없다.
3. `delegate`는 `interface` 내부에서 사용할 수 있지만, `event`는 `interface` 내부에서 사용할 수 없다.

### 🫧 Event 구현

`delegate`를 이용하여, `event` 키워드로 이벤트를 선언한다.  

```cs
// delegate 선언
delegate void MyDelegate(string msg);

// Publisher
class MyClass
{
	// 이벤트 선언
	public event MyDelegate MyEvent;

	// 구독 & 구독 해제
	public void Subscribe(MyDelegate myDelegate) => MyEvent += myDelegate;
	public void Unsubscribe(MyDelegate myDelegate) => MyEvent -= myDelegate;

	// 이벤트 발생 (이벤트는 클래스 내부에서만 호출 가능)
	public void OnEvent(string msg) => MyEvent?.Invoke(msg);
}

// Subscriber
class Program
{
	static void Main()
	{
		MyClass myClass = new MyClass();
		myClass.Subscribe(MyMethod);

		myClass.OnEvent("Hello, World!");

		// 아래처럼 이벤트를 외부에서 직접 호출 할 수 없다.
		// myClass.MyEvent?.Invoke("Hello, World!");
	}

	static void MyMethod(string msg) => Console.WriteLine(msg);
}
```

## 💫 참고

---

- `delegate`를 이용해 함수형 프로그래밍의 일급 객체로서의 함수 개념을 구현할 수 있다.
- `delegate` (`event`)를 이용해 이벤트, 옵저버 패턴을 구현할 수 있다.

- [](https://developer-talk.tistory.com/208)
